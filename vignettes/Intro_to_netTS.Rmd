---
title: "Introduction to netTS"
author: "Tyler R. Bonnell"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Introduction to netTS}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```


##Install netTS
```{r, warning=FALSE, message=FALSE}
#devtools::install_github("tbonne/netTS")
library(netTS)
library(lubridate)
library(ggplot2)
library(igraph)
library(reshape2)
```

##Look at some example data

This data is the rquired format for working with netTS: events format. The first two coloumns should have information about what two entities are interacting. The third column should be the weight of those interactions. Finally, the fourth column should contain a time/date column. This last column should be in date format (e.g., ymd, or ymd_hms). The lubridate package can be helpful for setting this up.
```{r}
groomEvents
```

Extract graph level measures through time. The graphTS function requires windowsize and windowshift inputs to be a time. Again lubridate can be very useful here, as you can specify many kinds of times: e.g., years(), months(), hours(), minutes(), seconds(). The measureFun input should be a function that takes as input an igraph network and returns one value. Here custom functions can be used or functions already in netTS can be used.
```{r}
graph.values <- graphTS(groomEvents, windowsize = days(30), windowshift = days(10), measureFun = degree_mean, directed=TRUE)
graph.values
```

Plot the graph level measures through time
```{r}
ggplot(graph.values, aes(x=windowstart, y=measure))+geom_point()+geom_line()+labs(y="Mean degree",x="Date")+theme_classic()
```

Does this differ from random network arrangement. The perumation used here randomly swaps individuals in the events dataframe. The results here suggest that the network shows lower mean degree than expected due to chance arrangement of events, i.e., individuals groom fewer partners than expected if grooming was random.  
```{r}
graph.values <- graphTS(groomEvents[1:200,], windowsize = days(30), windowshift = days(10), measureFun = degree_mean, directed=TRUE, nperm = 1000)
ggplot(graph.values, aes(x=windowstart, y=measure))+geom_point()+geom_line()+
  geom_ribbon(data=graph.values, aes(ymin=CI.low, ymax=CI.high), fill="red", alpha=0.2)+
  labs(y="Mean degree",x="Date")+theme_classic()
```

How quickly does the network change in time

Here we show that it is possible to measure changes in the network. The measureFun in this case (when lagged == TRUE) should take two networks and return a single value. Here we use the cosine similarity measure, and use firstNet == TRUE to compare the network over time to the first network observed. Similarly, we show the similar plot when comparing networks with a lag of 1 (i.e., 10 days apart due to windowshift of 10).
```{r}
graph.change <- graphTS(groomEvents, windowsize = days(30), windowshift = days(10), measureFun = cosine_between_graphs, directed=TRUE, lagged = TRUE, firstNet = TRUE)

graph.stability <- graphTS(groomEvents, windowsize = days(30), windowshift = days(10), measureFun = cosine_between_graphs, directed=TRUE, lagged = TRUE, lag = 1)


ggplot(graph.change, aes(x=windowstart, y=measure))+geom_point()+geom_line()+labs(y="Network change from start (cosine)",x="Date")+theme_classic()
ggplot(graph.stability, aes(x=windowstart, y=measure))+geom_point()+geom_line()+labs(y="Network stability (cosine)",x="Date")+theme_classic()

```





#Other levels of network change

It is also possible to ask how the network changes through time at the node level (i.e., the ego network) and the dyadic level (i.e., specific relationships).

Node level changes in degree trough time. Here the measureFun should be a function that takes one network and returns a value for each node.
```{r}
node.values <- nodeTS(groomEvents, windowsize = days(30), windowshift = days(10), measureFun = degree, directed=TRUE)
node.values
```

Plot node level changes
```{r}
df.node.values <- melt(node.values, id.vars = c("windowstart","windowend", "nEvents" ))
names(df.node.values)[names(df.node.values)=="variable"] <- "node"
names(df.node.values)[names(df.node.values)=="value"] <- "measure"
ggplot(df.node.values, aes(x=windowstart, y=measure, col=node))+geom_point()+geom_line() + theme_classic() + labs(y="Mean degree",x="Date")
```

Dyad level changes in weight trough time. Here the measureFun should be a function that takes one network and returns a value for each dyad.
```{r}
dyad.values <- dyadTS(groomEvents, windowsize = days(30), windowshift = days(10), measureFun = dyad_weight, directed=TRUE)
dyad.values
```

Plot node level changes
```{r}
df.dyad.values <- melt(dyad.values, id.vars = c("windowstart","windowend", "nEvents" ))
names(df.dyad.values)[names(df.dyad.values)=="variable"] <- "dyad"
names(df.dyad.values)[names(df.dyad.values)=="value"] <- "measure"
ggplot(df.dyad.values, aes(x=windowstart, y=measure, col=dyad))+geom_point()+geom_line() + theme_classic() + labs(y="Weight",x="Date") + theme(legend.position="right",legend.text = element_text(size=6))
```



